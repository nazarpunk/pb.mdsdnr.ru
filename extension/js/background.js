"use strict";
chrome.webRequest.onBeforeRequest.addListener(details => {
    const url = details.url.replace(`https://pb.mdsdnr.ru/`, ``);
    const ext = url.slice((url.lastIndexOf('.') - 1 >>> 0) + 2);
    if ([`css`, `js`, `map`, `png`, `gif`, `jpg`, `jpeg`, `eot`, `woff`, `woff2`, `svg`].includes(ext))
        return { redirectUrl: chrome.extension.getURL(url) };
}, { urls: [`*://pb.mdsdnr.ru/*`] }, [`blocking`]);
{
    const onMessage = (request, sender, sendResponse) => {
        const manifest = chrome.runtime.getManifest();
        if (request.hasOwnProperty(`setClientSidebar`)) {
            chrome.storage.local.get(['token'], result => {
                if (!result.hasOwnProperty(`token`))
                    return;
                fetch(`${manifest.homepage_url}/mindnr.php?user|updateClientSidebar`, {
                    method: `post`,
                    body: JSON.stringify({
                        client: request.setClientSidebar,
                        sidebar: request.sidebar,
                        token: result.token
                    })
                })
                    .then(r => r.json())
                    .then(data => sendResponse(data))
                    .catch(e => sendResponse({ error: e.message }));
            });
            return true;
        }
        if (request.hasOwnProperty(`getClientSidebar`)) {
            chrome.storage.local.get([`ID`, `clients`], result => {
                const out = {
                    ID: 0,
                    sidebar: []
                };
                if (result.hasOwnProperty(`ID`) && result.hasOwnProperty(`clients`)) {
                    result.clients.some((client) => {
                        if (client.login !== request.getClientSidebar)
                            return false;
                        out.ID = result.ID;
                        out.sidebar = client.sidebar === null ? [] : client.sidebar.split(`,`);
                        return true;
                    });
                }
                sendResponse(out);
            });
            return true;
        }
        if (request.hasOwnProperty(`getManifest`)) {
            sendResponse(manifest);
            return true;
        }
        if (request.hasOwnProperty(`getClients`)) {
            chrome.storage.local.get(['ID', 'clients', 'token'], result => sendResponse(result));
            return true;
        }
        if (request.hasOwnProperty(`updateData`)) {
            chrome.storage.local.get(['token'], result => {
                if (!result.hasOwnProperty(`token`))
                    return;
                fetch(`${manifest.homepage_url}/mindnr.php?user|getData`, {
                    method: `POST`,
                    body: result.token
                })
                    .then(r => r.json())
                    .then(data => {
                    if (data.hasOwnProperty(`error`))
                        return chrome.storage.local.clear();
                    if (data.hasOwnProperty(`ID`))
                        chrome.storage.local.set(data);
                })
                    .catch(e => console.warn(e));
            });
        }
        if (request.hasOwnProperty(`getClientSignature`)) {
            let out = {};
            chrome.storage.local.get([`signature`], result => {
                result.signature.forEach((item) => {
                    if (item.login === request.getClientSignature)
                        out[item.type] = item;
                });
                sendResponse(out);
            });
            return true;
        }
        if (request.hasOwnProperty(`saveClient`)) {
            fetch(`${manifest.homepage_url}/mindnr.php?user|saveClient`, {
                method: `POST`,
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(request.saveClient)
            })
                .then(r => r.json())
                .then(data => sendResponse(data))
                .catch(e => sendResponse({ error: e.message }));
            return true;
        }
        if (request.hasOwnProperty(`saveSignature`)) {
            chrome.storage.local.get(['token'], result => {
                if (!result.hasOwnProperty(`token`))
                    return;
                request.saveSignature.token = result.token;
                fetch(`${manifest.homepage_url}/mindnr.php?user|saveSignature`, {
                    method: `POST`,
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(request.saveSignature)
                })
                    .then(r => r.json())
                    .then(data => sendResponse(data))
                    .catch(e => sendResponse({ error: e.message }));
                return true;
            });
        }
        if (request.hasOwnProperty(`updateClientName`)) {
            chrome.storage.local.get(['token'], result => {
                if (!result.hasOwnProperty(`token`))
                    return;
                fetch(`${manifest.homepage_url}/mindnr.php?user|updateClientName`, {
                    method: `POST`,
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ token: result.token, login: request.login, name: request.updateClientName })
                })
                    .then(r => r.json())
                    .then(data => sendResponse(data))
                    .catch(e => sendResponse({ error: e.message }));
                return true;
            });
        }
        sendResponse({});
        return true;
    };
    chrome.runtime.onMessageExternal.addListener(onMessage);
}

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImV4dGVuc2lvbi9qcy9iYWNrZ3JvdW5kLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFDQSxNQUFNLENBQUMsVUFBVSxDQUFDLGVBQWUsQ0FBQyxXQUFXLENBQzVDLE9BQU8sQ0FBQyxFQUFFO0lBQ1QsTUFBTSxHQUFHLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsdUJBQXVCLEVBQUUsRUFBRSxDQUFDLENBQUM7SUFDN0QsTUFBTSxHQUFHLEdBQUcsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLEdBQUcsQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO0lBQzVELElBQUksQ0FBQyxLQUFLLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxPQUFPLEVBQUUsS0FBSyxDQUFDLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQztRQUFFLE9BQU8sRUFBQyxXQUFXLEVBQUUsTUFBTSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLEVBQUMsQ0FBQztBQUN4SixDQUFDLEVBQ0QsRUFBQyxJQUFJLEVBQUUsQ0FBQyxvQkFBb0IsQ0FBQyxFQUFDLEVBQzlCLENBQUMsVUFBVSxDQUFDLENBQ1osQ0FBQztBQUlGO0lBQ0MsTUFBTSxTQUFTLEdBQUcsQ0FBQyxPQUFZLEVBQUUsTUFBVyxFQUFFLFlBQWlCLEVBQUUsRUFBRTtRQUNsRSxNQUFNLFFBQVEsR0FBNEIsTUFBTSxDQUFDLE9BQU8sQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUd2RSxJQUFJLE9BQU8sQ0FBQyxjQUFjLENBQUMsa0JBQWtCLENBQUMsRUFBRTtZQUMvQyxNQUFNLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxPQUFPLENBQUMsRUFBRSxNQUFNLENBQUMsRUFBRTtn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WUFBWSxDQUFDLElBQUksQ0FBQyxDQUFDO3FCQUNoQyxLQUFLLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxZQUFZLENBQUMsRUFBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDLE9BQU8sRUFBQyxDQUFDLENBQUMsQ0FBQztnQkFDL0MsT0FBTyxJQUFJLENBQUM7WUFDYixDQUFDLENBQUMsQ0FBQztTQUNIO1FBR0QsWUFBWSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ2pCLE9BQU8sSUFBSSxDQUFDO0lBQ2IsQ0FBQyxDQUFBO0lBQ0QsTUFBTSxDQUFDLE9BQU8sQ0FBQyxpQkFBaUIsQ0FBQyxXQUFXLENBQUMsU0FBUyxDQUFDLENBQUM7Q0FDeEQiLCJmaWxlIjoiZXh0ZW5zaW9uL2pzL2JhY2tncm91bmQuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLzxlZGl0b3ItZm9sZCBkZXNjPVwib29CZWZvcmVSZXF1ZXN0XCI+XG5jaHJvbWUud2ViUmVxdWVzdC5vbkJlZm9yZVJlcXVlc3QuYWRkTGlzdGVuZXIoXG5cdGRldGFpbHMgPT4ge1xuXHRcdGNvbnN0IHVybCA9IGRldGFpbHMudXJsLnJlcGxhY2UoYGh0dHBzOi8vcGIubWRzZG5yLnJ1L2AsIGBgKTtcblx0XHRjb25zdCBleHQgPSB1cmwuc2xpY2UoKHVybC5sYXN0SW5kZXhPZignLicpIC0gMSA+Pj4gMCkgKyAyKTtcblx0XHRpZiAoW2Bjc3NgLCBganNgLCBgbWFwYCwgYHBuZ2AsIGBnaWZgLCBganBnYCwgYGpwZWdgLCBgZW90YCwgYHdvZmZgLCBgd29mZjJgLCBgc3ZnYF0uaW5jbHVkZXMoZXh0KSkgcmV0dXJuIHtyZWRpcmVjdFVybDogY2hyb21lLmV4dGVuc2lvbi5nZXRVUkwodXJsKX07XG5cdH0sXG5cdHt1cmxzOiBbYCo6Ly9wYi5tZHNkbnIucnUvKmBdfSxcblx0W2BibG9ja2luZ2BdXG4pO1xuLy88L2VkaXRvci1mb2xkPlxuXG4vLzxlZGl0b3ItZm9sZCBkZXNjPVwib25NZXNzYWdlXCI+XG57XG5cdGNvbnN0IG9uTWVzc2FnZSA9IChyZXF1ZXN0OiBhbnksIHNlbmRlcjogYW55LCBzZW5kUmVzcG9uc2U6IGFueSkgPT4ge1xuXHRcdGNvbnN0IG1hbmlmZXN0OiBjaHJvbWUucnVudGltZS5NYW5pZmVzdCA9IGNocm9tZS5ydW50aW1lLmdldE1hbmlmZXN0KCk7XG5cdFx0XG5cdFx0Ly8gPGVkaXRvci1mb2xkIGRlc2M9XCJzZXRDbGllbnRTaWRlYmFyXCI+XG5cdFx0aWYgKHJlcXVlc3QuaGFzT3duUHJvcGVydHkoYHNldENsaWVudFNpZGViYXJgKSkge1xuXHRcdFx0Y2hyb21lLnN0b3JhZ2UubG9jYWwuZ2V0KFsndG9rZW4nXSwgcmVzdWx0ID0+IHtcblx0XHRcdFx0aWYgKCFyZXN1bHQuaGFzT3duUHJvcGVydHkoYHRva2VuYCkpIHJldHVybjtcblx0XHRcdFx0ZmV0Y2goYCR7bWFuaWZlc3QuaG9tZXBhZ2VfdXJsfS9taW5kbnIucGhwP3VzZXJ8dXBkYXRlQ2xpZW50U2lkZWJhcmAsIHtcblx0XHRcdFx0XHRtZXRob2Q6IGBwb3N0YCxcblx0XHRcdFx0XHRib2R5ICA6IEpTT04uc3RyaW5naWZ5KHtcblx0XHRcdFx0XHRcdCAgICAgICAgICAgICAgICAgICAgICAgY2xpZW50IDogcmVxdWVzdC5zZXRDbGllbnRTaWRlYmFyLFxuXHRcdFx0XHRcdFx0ICAgICAgICAgICAgICAgICAgICAgICBzaWRlYmFyOiByZXF1ZXN0LnNpZGViYXIsXG5cdFx0XHRcdFx0XHQgICAgICAgICAgICAgICAgICAgICAgIHRva2VuICA6IHJlc3VsdC50b2tlblxuXHRcdFx0XHRcdCAgICAgICAgICAgICAgICAgICAgICAgfSlcblx0XHRcdFx0fSlcblx0XHRcdFx0XHQudGhlbihyID0+IHIuanNvbigpKVxuXHRcdFx0XHRcdC50aGVuKGRhdGEgPT4gc2VuZFJlc3BvbnNlKGRhdGEpKVxuXHRcdFx0XHRcdC5jYXRjaChlID0+IHNlbmRSZXNwb25zZSh7ZXJyb3I6IGUubWVzc2FnZX0pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0fVxuXHRcdC8vIDwvZWRpdG9yLWZvbGQ+XG5cdFx0XG5cdFx0Ly8gPGVkaXRvci1mb2xkIGRlc2M9XCJnZXRDbGllbnRTaWRlYmFyXCI+XG5cdFx0aWYgKHJlcXVlc3QuaGFzT3duUHJvcGVydHkoYGdldENsaWVudFNpZGViYXJgKSkge1xuXHRcdFx0Y2hyb21lLnN0b3JhZ2UubG9jYWwuZ2V0KFtgSURgLCBgY2xpZW50c2BdLCByZXN1bHQgPT4ge1xuXHRcdFx0XHRjb25zdCBvdXQ6IHtcblx0XHRcdFx0XHRJRDogbnVtYmVyLFxuXHRcdFx0XHRcdHNpZGViYXI6IHN0cmluZ1tdXG5cdFx0XHRcdH0gPSB7XG5cdFx0XHRcdFx0SUQgICAgIDogMCxcblx0XHRcdFx0XHRzaWRlYmFyOiBbXVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRpZiAocmVzdWx0Lmhhc093blByb3BlcnR5KGBJRGApICYmIHJlc3VsdC5oYXNPd25Qcm9wZXJ0eShgY2xpZW50c2ApKSB7XG5cdFx0XHRcdFx0cmVzdWx0LmNsaWVudHMuc29tZSgoY2xpZW50OiB7XG5cdFx0XHRcdFx0XHRsb2dpbjogc3RyaW5nLFxuXHRcdFx0XHRcdFx0c2lkZWJhcjogc3RyaW5nXG5cdFx0XHRcdFx0fSkgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKGNsaWVudC5sb2dpbiAhPT0gcmVxdWVzdC5nZXRDbGllbnRTaWRlYmFyKSByZXR1cm4gZmFsc2U7XG5cdFx0XHRcdFx0XHRvdXQuSUQgPSByZXN1bHQuSUQ7XG5cdFx0XHRcdFx0XHRvdXQuc2lkZWJhciA9IGNsaWVudC5zaWRlYmFyID09PSBudWxsID8gW10gOiBjbGllbnQuc2lkZWJhci5zcGxpdChgLGApO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdFx0c2VuZFJlc3BvbnNlKG91dCk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiB0cnVlO1xuXHRcdH1cblx0XHQvLyA8L2VkaXRvci1mb2xkPlxuXHRcdFxuXHRcdC8vIDxlZGl0b3ItZm9sZCBkZXNjPVwiZ2V0VmVyc2lvblwiPlxuXHRcdGlmIChyZXF1ZXN0Lmhhc093blByb3BlcnR5KGBnZXRNYW5pZmVzdGApKSB7XG5cdFx0XHRzZW5kUmVzcG9uc2UobWFuaWZlc3QpO1xuXHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0fVxuXHRcdC8vIDwvZWRpdG9yLWZvbGQ+XG5cdFx0XG5cdFx0Ly8gPGVkaXRvci1mb2xkIGRlc2M9XCJnZXRDbGllbnRzXCI+XG5cdFx0aWYgKHJlcXVlc3QuaGFzT3duUHJvcGVydHkoYGdldENsaWVudHNgKSkge1xuXHRcdFx0Y2hyb21lLnN0b3JhZ2UubG9jYWwuZ2V0KFsnSUQnLCAnY2xpZW50cycsICd0b2tlbiddLCByZXN1bHQgPT4gc2VuZFJlc3BvbnNlKHJlc3VsdCkpO1xuXHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0fVxuXHRcdC8vIDwvZWRpdG9yLWZvbGQ+XG5cdFx0XG5cdFx0Ly8gPGVkaXRvci1mb2xkIGRlc2M9XCJ1cGRhdGVEYXRhXCI+XG5cdFx0aWYgKHJlcXVlc3QuaGFzT3duUHJvcGVydHkoYHVwZGF0ZURhdGFgKSkge1xuXHRcdFx0Y2hyb21lLnN0b3JhZ2UubG9jYWwuZ2V0KFsndG9rZW4nXSwgcmVzdWx0ID0+IHtcblx0XHRcdFx0aWYgKCFyZXN1bHQuaGFzT3duUHJvcGVydHkoYHRva2VuYCkpIHJldHVybjtcblx0XHRcdFx0ZmV0Y2goYCR7bWFuaWZlc3QuaG9tZXBhZ2VfdXJsfS9taW5kbnIucGhwP3VzZXJ8Z2V0RGF0YWAsIHtcblx0XHRcdFx0XHRtZXRob2Q6IGBQT1NUYCxcblx0XHRcdFx0XHRib2R5ICA6IHJlc3VsdC50b2tlblxuXHRcdFx0XHR9KVxuXHRcdFx0XHRcdC50aGVuKHIgPT4gci5qc29uKCkpXG5cdFx0XHRcdFx0LnRoZW4oZGF0YSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAoZGF0YS5oYXNPd25Qcm9wZXJ0eShgZXJyb3JgKSkgcmV0dXJuIGNocm9tZS5zdG9yYWdlLmxvY2FsLmNsZWFyKCk7XG5cdFx0XHRcdFx0XHRpZiAoZGF0YS5oYXNPd25Qcm9wZXJ0eShgSURgKSkgY2hyb21lLnN0b3JhZ2UubG9jYWwuc2V0KGRhdGEpO1xuXHRcdFx0XHRcdH0pXG5cdFx0XHRcdFx0LmNhdGNoKGUgPT4gY29uc29sZS53YXJuKGUpKTtcblx0XHRcdH0pO1xuXHRcdH1cblx0XHQvLyA8L2VkaXRvci1mb2xkPlxuXHRcdFxuXHRcdC8vIDxlZGl0b3ItZm9sZCBkZXNjPVwiZ2V0Q2xpZW50U2lnbmF0dXJlXCI+XG5cdFx0aWYgKHJlcXVlc3QuaGFzT3duUHJvcGVydHkoYGdldENsaWVudFNpZ25hdHVyZWApKSB7XG5cdFx0XHRsZXQgb3V0OiB7XG5cdFx0XHRcdFtrZXk6IHN0cmluZ106IHt9XG5cdFx0XHR9ID0ge307XG5cdFx0XHRjaHJvbWUuc3RvcmFnZS5sb2NhbC5nZXQoW2BzaWduYXR1cmVgXSwgcmVzdWx0ID0+IHtcblx0XHRcdFx0cmVzdWx0LnNpZ25hdHVyZS5mb3JFYWNoKChpdGVtOiB7XG5cdFx0XHRcdFx0bG9naW46IHN0cmluZyxcblx0XHRcdFx0XHR0eXBlOiBzdHJpbmdcblx0XHRcdFx0fSkgPT4ge1xuXHRcdFx0XHRcdGlmIChpdGVtLmxvZ2luID09PSByZXF1ZXN0LmdldENsaWVudFNpZ25hdHVyZSkgb3V0W2l0ZW0udHlwZV0gPSBpdGVtO1xuXHRcdFx0XHR9KTtcblx0XHRcdFx0c2VuZFJlc3BvbnNlKG91dCk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiB0cnVlO1xuXHRcdH1cblx0XHQvLyA8L2VkaXRvci1mb2xkPlxuXHRcdFxuXHRcdC8vIDxlZGl0b3ItZm9sZCBkZXNjPVwic2F2ZUNsaWVudFwiPlxuXHRcdGlmIChyZXF1ZXN0Lmhhc093blByb3BlcnR5KGBzYXZlQ2xpZW50YCkpIHtcblx0XHRcdGZldGNoKGAke21hbmlmZXN0LmhvbWVwYWdlX3VybH0vbWluZG5yLnBocD91c2VyfHNhdmVDbGllbnRgLCB7XG5cdFx0XHRcdG1ldGhvZCA6IGBQT1NUYCxcblx0XHRcdFx0aGVhZGVyczoge1xuXHRcdFx0XHRcdCdBY2NlcHQnICAgICAgOiAnYXBwbGljYXRpb24vanNvbicsXG5cdFx0XHRcdFx0J0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJ1xuXHRcdFx0XHR9LFxuXHRcdFx0XHRib2R5ICAgOiBKU09OLnN0cmluZ2lmeShyZXF1ZXN0LnNhdmVDbGllbnQpXG5cdFx0XHR9KVxuXHRcdFx0XHQudGhlbihyID0+IHIuanNvbigpKVxuXHRcdFx0XHQudGhlbihkYXRhID0+IHNlbmRSZXNwb25zZShkYXRhKSlcblx0XHRcdFx0LmNhdGNoKGUgPT4gc2VuZFJlc3BvbnNlKHtlcnJvcjogZS5tZXNzYWdlfSkpO1xuXHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0fVxuXHRcdC8vIDwvZWRpdG9yLWZvbGQ+XG5cdFx0XG5cdFx0Ly8gPGVkaXRvci1mb2xkIGRlc2M9XCJzYXZlU2lnbmF0dXJlXCI+XG5cdFx0aWYgKHJlcXVlc3QuaGFzT3duUHJvcGVydHkoYHNhdmVTaWduYXR1cmVgKSkge1xuXHRcdFx0Y2hyb21lLnN0b3JhZ2UubG9jYWwuZ2V0KFsndG9rZW4nXSwgcmVzdWx0ID0+IHtcblx0XHRcdFx0aWYgKCFyZXN1bHQuaGFzT3duUHJvcGVydHkoYHRva2VuYCkpIHJldHVybjtcblx0XHRcdFx0cmVxdWVzdC5zYXZlU2lnbmF0dXJlLnRva2VuID0gcmVzdWx0LnRva2VuO1xuXHRcdFx0XHRmZXRjaChgJHttYW5pZmVzdC5ob21lcGFnZV91cmx9L21pbmRuci5waHA/dXNlcnxzYXZlU2lnbmF0dXJlYCwge1xuXHRcdFx0XHRcdG1ldGhvZCA6IGBQT1NUYCxcblx0XHRcdFx0XHRoZWFkZXJzOiB7XG5cdFx0XHRcdFx0XHQnQWNjZXB0JyAgICAgIDogJ2FwcGxpY2F0aW9uL2pzb24nLFxuXHRcdFx0XHRcdFx0J0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJ1xuXHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0Ym9keSAgIDogSlNPTi5zdHJpbmdpZnkocmVxdWVzdC5zYXZlU2lnbmF0dXJlKVxuXHRcdFx0XHR9KVxuXHRcdFx0XHRcdC50aGVuKHIgPT4gci5qc29uKCkpXG5cdFx0XHRcdFx0LnRoZW4oZGF0YSA9PiBzZW5kUmVzcG9uc2UoZGF0YSkpXG5cdFx0XHRcdFx0LmNhdGNoKGUgPT4gc2VuZFJlc3BvbnNlKHtlcnJvcjogZS5tZXNzYWdlfSkpO1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdH0pO1xuXHRcdH1cblx0XHQvLyA8L2VkaXRvci1mb2xkPlxuXHRcdFxuXHRcdC8vIDxlZGl0b3ItZm9sZCBkZXNjPVwidXBkYXRlQ2xpZW50TmFtZVwiPlxuXHRcdGlmIChyZXF1ZXN0Lmhhc093blByb3BlcnR5KGB1cGRhdGVDbGllbnROYW1lYCkpIHtcblx0XHRcdGNocm9tZS5zdG9yYWdlLmxvY2FsLmdldChbJ3Rva2VuJ10sIHJlc3VsdCA9PiB7XG5cdFx0XHRcdGlmICghcmVzdWx0Lmhhc093blByb3BlcnR5KGB0b2tlbmApKSByZXR1cm47XG5cdFx0XHRcdGZldGNoKGAke21hbmlmZXN0LmhvbWVwYWdlX3VybH0vbWluZG5yLnBocD91c2VyfHVwZGF0ZUNsaWVudE5hbWVgLCB7XG5cdFx0XHRcdFx0bWV0aG9kIDogYFBPU1RgLFxuXHRcdFx0XHRcdGhlYWRlcnM6IHtcblx0XHRcdFx0XHRcdCdBY2NlcHQnICAgICAgOiAnYXBwbGljYXRpb24vanNvbicsXG5cdFx0XHRcdFx0XHQnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nXG5cdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRib2R5ICAgOiBKU09OLnN0cmluZ2lmeSh7dG9rZW46IHJlc3VsdC50b2tlbiwgbG9naW46IHJlcXVlc3QubG9naW4sIG5hbWU6IHJlcXVlc3QudXBkYXRlQ2xpZW50TmFtZX0pXG5cdFx0XHRcdH0pXG5cdFx0XHRcdFx0LnRoZW4ociA9PiByLmpzb24oKSlcblx0XHRcdFx0XHQudGhlbihkYXRhID0+IHNlbmRSZXNwb25zZShkYXRhKSlcblx0XHRcdFx0XHQuY2F0Y2goZSA9PiBzZW5kUmVzcG9uc2Uoe2Vycm9yOiBlLm1lc3NhZ2V9KSk7XG5cdFx0XHRcdHJldHVybiB0cnVlO1xuXHRcdFx0fSk7XG5cdFx0fVxuXHRcdC8vIDwvZWRpdG9yLWZvbGQ+XG5cdFx0XG5cdFx0c2VuZFJlc3BvbnNlKHt9KTtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXHRjaHJvbWUucnVudGltZS5vbk1lc3NhZ2VFeHRlcm5hbC5hZGRMaXN0ZW5lcihvbk1lc3NhZ2UpO1xufVxuLy88L2VkaXRvci1mb2xkPiJdfQ==
