"use strict";
{
    const onMessage = (request, sender, sendResponse) => {
        const manifest = chrome.runtime.getManifest();
        if (request.hasOwnProperty(`setClientSidebar`)) {
            chrome.storage.local.get(['token'], result => {
                if (!result.hasOwnProperty(`token`))
                    return;
                fetch(`${manifest.homepage_url}/mindnr.php?user|updateClientSidebar`, {
                    method: `post`,
                    body: JSON.stringify({
                        client: request.setClientSidebar,
                        sidebar: request.sidebar,
                        token: result.token
                    })
                })
                    .then(r => r.json())
                    .then(data => sendResponse(data))
                    .catch(e => sendResponse({ error: e.message }));
            });
            return true;
        }
        if (request.hasOwnProperty(`getClientSidebar`)) {
            chrome.storage.local.get([`ID`, `clients`], result => {
                const out = { ID: 0, sidebar: [] };
                if (result.hasOwnProperty(`ID`) && result.hasOwnProperty(`clients`)) {
                    result.clients.some(client => {
                        if (client.login !== request.getClientSidebar)
                            return false;
                        out.ID = result.ID;
                        out.sidebar = client.sidebar === null ? [] : client.sidebar.split(`,`);
                        return true;
                    });
                }
                sendResponse(out);
            });
            return true;
        }
        if (request.hasOwnProperty(`getManifest`)) {
            sendResponse(manifest);
            return true;
        }
        if (request.hasOwnProperty(`getClients`)) {
            chrome.storage.local.get(['ID', 'clients', 'token'], result => sendResponse(result));
            return true;
        }
        if (request.hasOwnProperty(`updateData`)) {
            chrome.storage.local.get(['token'], result => {
                if (!result.hasOwnProperty(`token`))
                    return;
                fetch(`${manifest.homepage_url}/mindnr.php?user|getData`, {
                    method: `POST`,
                    body: result.token
                })
                    .then(r => r.json())
                    .then(data => {
                    if (data.hasOwnProperty(`error`))
                        return chrome.storage.local.clear();
                    if (data.hasOwnProperty(`ID`))
                        chrome.storage.local.set(data);
                })
                    .catch(e => console.warn(e));
            });
        }
        if (request.hasOwnProperty(`getClientSignature`)) {
            let out = {};
            chrome.storage.local.get([`signature`], result => {
                result.signature.forEach(item => {
                    if (item.login === request.getClientSignature)
                        out[item.type] = item;
                });
                sendResponse(out);
            });
            return true;
        }
        if (request.hasOwnProperty(`saveClient`)) {
            fetch(`${manifest.homepage_url}/mindnr.php?user|saveClient`, {
                method: `POST`,
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(request.saveClient)
            })
                .then(r => r.json())
                .then(data => sendResponse(data))
                .catch(e => sendResponse({ error: e.message }));
            return true;
        }
        if (request.hasOwnProperty(`saveSignature`)) {
            chrome.storage.local.get(['token'], result => {
                if (!result.hasOwnProperty(`token`))
                    return;
                request.saveSignature.token = result.token;
                fetch(`${manifest.homepage_url}/mindnr.php?user|saveSignature`, {
                    method: `POST`,
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(request.saveSignature)
                })
                    .then(r => r.json())
                    .then(data => sendResponse(data))
                    .catch(e => sendResponse({ error: e.message }));
                return true;
            });
        }
        if (request.hasOwnProperty(`updateClientName`)) {
            chrome.storage.local.get(['token'], result => {
                if (!result.hasOwnProperty(`token`))
                    return;
                fetch(`${manifest.homepage_url}/mindnr.php?user|updateClientName`, {
                    method: `POST`,
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ token: result.token, login: request.login, name: request.updateClientName })
                })
                    .then(r => r.json())
                    .then(data => sendResponse(data))
                    .catch(e => sendResponse({ error: e.message }));
                return true;
            });
        }
        sendResponse({});
        return true;
    };
    chrome.runtime.onMessageExternal.addListener(onMessage);
}

//# sourceMappingURL=data:application/json;charset=utf8;base64,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O29CQUNkLE9BQU8sRUFBRTt3QkFDTCxRQUFRLEVBQUUsa0JBQWtCO3dCQUM1QixjQUFjLEVBQUUsa0JBQWtCO3FCQUNyQztvQkFDRCxJQUFJLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxFQUFDLEtBQUssRUFBRSxNQUFNLENBQUMsS0FBSyxFQUFFLEtBQUssRUFBRSxPQUFPLENBQUMsS0FBSyxFQUFFLElBQUksRUFBRSxPQUFPLENBQUMsZ0JBQWdCLEVBQUMsQ0FBQztpQkFDcEcsQ0FBQztxQkFDRyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUM7cUJBQ25CLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsQ0FBQztxQkFDaEMsS0FBSyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsWUFBWSxDQUFDLEVBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQyxPQUFPLEVBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ2xELE9BQU8sSUFBSSxDQUFDO1lBQ2hCLENBQUMsQ0FBQyxDQUFDO1NBQ047UUFHRCxZQUFZLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDakIsT0FBTyxJQUFJLENBQUM7SUFDaEIsQ0FBQyxDQUFBO0lBQ0QsTUFBTSxDQUFDLE9BQU8sQ0FBQyxpQkFBaUIsQ0FBQyxXQUFXLENBQUMsU0FBUyxDQUFDLENBQUM7Q0FDM0QiLCJmaWxlIjoiZXh0ZW5zaW9uL2pzL29uTWVzc2FnZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIEB0cy1ub2NoZWNrXHJcbntcclxuICAgIGNvbnN0IG9uTWVzc2FnZSA9IChyZXF1ZXN0OiBhbnksIHNlbmRlcjogYW55LCBzZW5kUmVzcG9uc2U6IGFueSkgPT4ge1xyXG4gICAgICAgIGNvbnN0IG1hbmlmZXN0OiBvYmplY3QgPSBjaHJvbWUucnVudGltZS5nZXRNYW5pZmVzdCgpO1xyXG5cclxuICAgICAgICAvLyA8ZWRpdG9yLWZvbGQgZGVzYz1cInNldENsaWVudFNpZGViYXJcIj5cclxuICAgICAgICBpZiAocmVxdWVzdC5oYXNPd25Qcm9wZXJ0eShgc2V0Q2xpZW50U2lkZWJhcmApKSB7XHJcbiAgICAgICAgICAgIGNocm9tZS5zdG9yYWdlLmxvY2FsLmdldDxhbnk+KFsndG9rZW4nXSwgcmVzdWx0ID0+IHtcclxuICAgICAgICAgICAgICAgIGlmICghcmVzdWx0Lmhhc093blByb3BlcnR5KGB0b2tlbmApKSByZXR1cm47XHJcbiAgICAgICAgICAgICAgICBmZXRjaChgJHttYW5pZmVzdC5ob21lcGFnZV91cmx9L21pbmRuci5waHA/dXNlcnx1cGRhdGVDbGllbnRTaWRlYmFyYCwge1xyXG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogYHBvc3RgLFxyXG4gICAgICAgICAgICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2xpZW50OiByZXF1ZXN0LnNldENsaWVudFNpZGViYXIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNpZGViYXI6IHJlcXVlc3Quc2lkZWJhcixcclxuICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW46IHJlc3VsdC50b2tlblxyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKHIgPT4gci5qc29uKCkpXHJcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZGF0YSA9PiBzZW5kUmVzcG9uc2UoZGF0YSkpXHJcbiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGUgPT4gc2VuZFJlc3BvbnNlKHtlcnJvcjogZS5tZXNzYWdlfSkpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIDwvZWRpdG9yLWZvbGQ+XHJcblxyXG4gICAgICAgIC8vIDxlZGl0b3ItZm9sZCBkZXNjPVwiZ2V0Q2xpZW50U2lkZWJhclwiPlxyXG4gICAgICAgIGlmIChyZXF1ZXN0Lmhhc093blByb3BlcnR5KGBnZXRDbGllbnRTaWRlYmFyYCkpIHtcclxuICAgICAgICAgICAgY2hyb21lLnN0b3JhZ2UubG9jYWwuZ2V0PGFueT4oW2BJRGAsIGBjbGllbnRzYF0sIHJlc3VsdCA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBvdXQgPSB7SUQ6IDAsIHNpZGViYXI6IFtdfTtcclxuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuaGFzT3duUHJvcGVydHkoYElEYCkgJiYgcmVzdWx0Lmhhc093blByb3BlcnR5KGBjbGllbnRzYCkpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXN1bHQuY2xpZW50cy5zb21lKGNsaWVudCA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjbGllbnQubG9naW4gIT09IHJlcXVlc3QuZ2V0Q2xpZW50U2lkZWJhcikgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvdXQuSUQgPSByZXN1bHQuSUQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG91dC5zaWRlYmFyID0gY2xpZW50LnNpZGViYXIgPT09IG51bGwgPyBbXSA6IGNsaWVudC5zaWRlYmFyLnNwbGl0KGAsYCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgc2VuZFJlc3BvbnNlKG91dCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gPC9lZGl0b3ItZm9sZD5cclxuXHJcbiAgICAgICAgLy8gPGVkaXRvci1mb2xkIGRlc2M9XCJnZXRWZXJzaW9uXCI+XHJcbiAgICAgICAgaWYgKHJlcXVlc3QuaGFzT3duUHJvcGVydHkoYGdldE1hbmlmZXN0YCkpIHtcclxuICAgICAgICAgICAgc2VuZFJlc3BvbnNlKG1hbmlmZXN0KTtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIDwvZWRpdG9yLWZvbGQ+XHJcblxyXG4gICAgICAgIC8vIDxlZGl0b3ItZm9sZCBkZXNjPVwiZ2V0Q2xpZW50c1wiPlxyXG4gICAgICAgIGlmIChyZXF1ZXN0Lmhhc093blByb3BlcnR5KGBnZXRDbGllbnRzYCkpIHtcclxuICAgICAgICAgICAgY2hyb21lLnN0b3JhZ2UubG9jYWwuZ2V0PGFueT4oWydJRCcsICdjbGllbnRzJywgJ3Rva2VuJ10sIHJlc3VsdCA9PiBzZW5kUmVzcG9uc2UocmVzdWx0KSk7XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyA8L2VkaXRvci1mb2xkPlxyXG5cclxuICAgICAgICAvLyA8ZWRpdG9yLWZvbGQgZGVzYz1cInVwZGF0ZURhdGFcIj5cclxuICAgICAgICBpZiAocmVxdWVzdC5oYXNPd25Qcm9wZXJ0eShgdXBkYXRlRGF0YWApKSB7XHJcbiAgICAgICAgICAgIGNocm9tZS5zdG9yYWdlLmxvY2FsLmdldDxhbnk+KFsndG9rZW4nXSwgcmVzdWx0ID0+IHtcclxuICAgICAgICAgICAgICAgIGlmICghcmVzdWx0Lmhhc093blByb3BlcnR5KGB0b2tlbmApKSByZXR1cm47XHJcbiAgICAgICAgICAgICAgICBmZXRjaChgJHttYW5pZmVzdC5ob21lcGFnZV91cmx9L21pbmRuci5waHA/dXNlcnxnZXREYXRhYCwge1xyXG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogYFBPU1RgLFxyXG4gICAgICAgICAgICAgICAgICAgIGJvZHk6IHJlc3VsdC50b2tlblxyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAudGhlbihyID0+IHIuanNvbigpKVxyXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGRhdGEgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5oYXNPd25Qcm9wZXJ0eShgZXJyb3JgKSkgcmV0dXJuIGNocm9tZS5zdG9yYWdlLmxvY2FsLmNsZWFyKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLmhhc093blByb3BlcnR5KGBJRGApKSBjaHJvbWUuc3RvcmFnZS5sb2NhbC5zZXQoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZSA9PiBjb25zb2xlLndhcm4oZSkpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gPC9lZGl0b3ItZm9sZD5cclxuXHJcbiAgICAgICAgLy8gPGVkaXRvci1mb2xkIGRlc2M9XCJnZXRDbGllbnRTaWduYXR1cmVcIj5cclxuICAgICAgICBpZiAocmVxdWVzdC5oYXNPd25Qcm9wZXJ0eShgZ2V0Q2xpZW50U2lnbmF0dXJlYCkpIHtcclxuICAgICAgICAgICAgbGV0IG91dCA9IHt9O1xyXG4gICAgICAgICAgICBjaHJvbWUuc3RvcmFnZS5sb2NhbC5nZXQ8YW55PihbYHNpZ25hdHVyZWBdLCByZXN1bHQgPT4ge1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0LnNpZ25hdHVyZS5mb3JFYWNoKGl0ZW0gPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLmxvZ2luID09PSByZXF1ZXN0LmdldENsaWVudFNpZ25hdHVyZSkgb3V0W2l0ZW0udHlwZV0gPSBpdGVtO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICBzZW5kUmVzcG9uc2Uob3V0KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyA8L2VkaXRvci1mb2xkPlxyXG5cclxuICAgICAgICAvLyA8ZWRpdG9yLWZvbGQgZGVzYz1cInNhdmVDbGllbnRcIj5cclxuICAgICAgICBpZiAocmVxdWVzdC5oYXNPd25Qcm9wZXJ0eShgc2F2ZUNsaWVudGApKSB7XHJcbiAgICAgICAgICAgIGZldGNoKGAke21hbmlmZXN0LmhvbWVwYWdlX3VybH0vbWluZG5yLnBocD91c2VyfHNhdmVDbGllbnRgLCB7XHJcbiAgICAgICAgICAgICAgICBtZXRob2Q6IGBQT1NUYCxcclxuICAgICAgICAgICAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAgICAgICAgICAgICAnQWNjZXB0JzogJ2FwcGxpY2F0aW9uL2pzb24nLFxyXG4gICAgICAgICAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbidcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShyZXF1ZXN0LnNhdmVDbGllbnQpXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAudGhlbihyID0+IHIuanNvbigpKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZGF0YSA9PiBzZW5kUmVzcG9uc2UoZGF0YSkpXHJcbiAgICAgICAgICAgICAgICAuY2F0Y2goZSA9PiBzZW5kUmVzcG9uc2Uoe2Vycm9yOiBlLm1lc3NhZ2V9KSk7XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyA8L2VkaXRvci1mb2xkPlxyXG5cclxuICAgICAgICAvLyA8ZWRpdG9yLWZvbGQgZGVzYz1cInNhdmVTaWduYXR1cmVcIj5cclxuICAgICAgICBpZiAocmVxdWVzdC5oYXNPd25Qcm9wZXJ0eShgc2F2ZVNpZ25hdHVyZWApKSB7XHJcbiAgICAgICAgICAgIGNocm9tZS5zdG9yYWdlLmxvY2FsLmdldDxhbnk+KFsndG9rZW4nXSwgcmVzdWx0ID0+IHtcclxuICAgICAgICAgICAgICAgIGlmICghcmVzdWx0Lmhhc093blByb3BlcnR5KGB0b2tlbmApKSByZXR1cm47XHJcbiAgICAgICAgICAgICAgICByZXF1ZXN0LnNhdmVTaWduYXR1cmUudG9rZW4gPSByZXN1bHQudG9rZW47XHJcbiAgICAgICAgICAgICAgICBmZXRjaChgJHttYW5pZmVzdC5ob21lcGFnZV91cmx9L21pbmRuci5waHA/dXNlcnxzYXZlU2lnbmF0dXJlYCwge1xyXG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogYFBPU1RgLFxyXG4gICAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJ0FjY2VwdCc6ICdhcHBsaWNhdGlvbi9qc29uJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJ1xyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkocmVxdWVzdC5zYXZlU2lnbmF0dXJlKVxyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAudGhlbihyID0+IHIuanNvbigpKVxyXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGRhdGEgPT4gc2VuZFJlc3BvbnNlKGRhdGEpKVxyXG4gICAgICAgICAgICAgICAgICAgIC5jYXRjaChlID0+IHNlbmRSZXNwb25zZSh7ZXJyb3I6IGUubWVzc2FnZX0pKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gPC9lZGl0b3ItZm9sZD5cclxuXHJcbiAgICAgICAgLy8gPGVkaXRvci1mb2xkIGRlc2M9XCJ1cGRhdGVDbGllbnROYW1lXCI+XHJcbiAgICAgICAgaWYgKHJlcXVlc3QuaGFzT3duUHJvcGVydHkoYHVwZGF0ZUNsaWVudE5hbWVgKSkge1xyXG4gICAgICAgICAgICBjaHJvbWUuc3RvcmFnZS5sb2NhbC5nZXQ8YW55PihbJ3Rva2VuJ10sIHJlc3VsdCA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXJlc3VsdC5oYXNPd25Qcm9wZXJ0eShgdG9rZW5gKSkgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgZmV0Y2goYCR7bWFuaWZlc3QuaG9tZXBhZ2VfdXJsfS9taW5kbnIucGhwP3VzZXJ8dXBkYXRlQ2xpZW50TmFtZWAsIHtcclxuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6IGBQT1NUYCxcclxuICAgICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICdBY2NlcHQnOiAnYXBwbGljYXRpb24vanNvbicsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbidcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHt0b2tlbjogcmVzdWx0LnRva2VuLCBsb2dpbjogcmVxdWVzdC5sb2dpbiwgbmFtZTogcmVxdWVzdC51cGRhdGVDbGllbnROYW1lfSlcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4ociA9PiByLmpzb24oKSlcclxuICAgICAgICAgICAgICAgICAgICAudGhlbihkYXRhID0+IHNlbmRSZXNwb25zZShkYXRhKSlcclxuICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZSA9PiBzZW5kUmVzcG9uc2Uoe2Vycm9yOiBlLm1lc3NhZ2V9KSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIDwvZWRpdG9yLWZvbGQ+XHJcblxyXG4gICAgICAgIHNlbmRSZXNwb25zZSh7fSk7XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcbiAgICBjaHJvbWUucnVudGltZS5vbk1lc3NhZ2VFeHRlcm5hbC5hZGRMaXN0ZW5lcihvbk1lc3NhZ2UpO1xyXG59Il19
